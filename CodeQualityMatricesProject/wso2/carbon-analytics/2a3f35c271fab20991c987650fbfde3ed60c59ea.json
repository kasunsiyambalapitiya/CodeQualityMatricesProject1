{"sha":"2a3f35c271fab20991c987650fbfde3ed60c59ea","commit":{"author":{"name":"Sachith Withana","email":"swsachith@gmail.com","date":"2016-11-24T08:57:47Z"},"committer":{"name":"Sachith Withana","email":"swsachith@gmail.com","date":"2016-11-24T08:57:47Z"},"message":"fixing CANALYTICS-8\nhttps://wso2.org/jira/projects/CANALYTICS/issues/CANALYTICS-8","tree":{"sha":"3fa768c2f5e208d4a4fab4066924f4878b043cc5","url":"https://api.github.com/repos/wso2/carbon-analytics/git/trees/3fa768c2f5e208d4a4fab4066924f4878b043cc5"},"url":"https://api.github.com/repos/wso2/carbon-analytics/git/commits/2a3f35c271fab20991c987650fbfde3ed60c59ea","comment_count":0},"url":"https://api.github.com/repos/wso2/carbon-analytics/commits/2a3f35c271fab20991c987650fbfde3ed60c59ea","html_url":"https://github.com/wso2/carbon-analytics/commit/2a3f35c271fab20991c987650fbfde3ed60c59ea","comments_url":"https://api.github.com/repos/wso2/carbon-analytics/commits/2a3f35c271fab20991c987650fbfde3ed60c59ea/comments","author":{"login":"swsachith","id":1327121,"avatar_url":"https://avatars.githubusercontent.com/u/1327121?v=3","gravatar_id":"","url":"https://api.github.com/users/swsachith","html_url":"https://github.com/swsachith","followers_url":"https://api.github.com/users/swsachith/followers","following_url":"https://api.github.com/users/swsachith/following{/other_user}","gists_url":"https://api.github.com/users/swsachith/gists{/gist_id}","starred_url":"https://api.github.com/users/swsachith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swsachith/subscriptions","organizations_url":"https://api.github.com/users/swsachith/orgs","repos_url":"https://api.github.com/users/swsachith/repos","events_url":"https://api.github.com/users/swsachith/events{/privacy}","received_events_url":"https://api.github.com/users/swsachith/received_events","type":"User","site_admin":false},"committer":{"login":"swsachith","id":1327121,"avatar_url":"https://avatars.githubusercontent.com/u/1327121?v=3","gravatar_id":"","url":"https://api.github.com/users/swsachith","html_url":"https://github.com/swsachith","followers_url":"https://api.github.com/users/swsachith/followers","following_url":"https://api.github.com/users/swsachith/following{/other_user}","gists_url":"https://api.github.com/users/swsachith/gists{/gist_id}","starred_url":"https://api.github.com/users/swsachith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swsachith/subscriptions","organizations_url":"https://api.github.com/users/swsachith/orgs","repos_url":"https://api.github.com/users/swsachith/repos","events_url":"https://api.github.com/users/swsachith/events{/privacy}","received_events_url":"https://api.github.com/users/swsachith/received_events","type":"User","site_admin":false},"parents":[{"sha":"4411f51afe2bb925559fd39e3c48993ca31e2a12","url":"https://api.github.com/repos/wso2/carbon-analytics/commits/4411f51afe2bb925559fd39e3c48993ca31e2a12","html_url":"https://github.com/wso2/carbon-analytics/commit/4411f51afe2bb925559fd39e3c48993ca31e2a12"}],"stats":{"total":58,"additions":55,"deletions":3},"files":[{"sha":"f789ce64d8e0edd52ece064130571ffd8340745b","filename":"components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/main/java/org/wso2/carbon/analytics/datasource/cassandra/CassandraUtils.java","status":"modified","additions":8,"deletions":3,"changes":11,"blob_url":"https://github.com/wso2/carbon-analytics/blob/2a3f35c271fab20991c987650fbfde3ed60c59ea/components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/main/java/org/wso2/carbon/analytics/datasource/cassandra/CassandraUtils.java","raw_url":"https://github.com/wso2/carbon-analytics/raw/2a3f35c271fab20991c987650fbfde3ed60c59ea/components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/main/java/org/wso2/carbon/analytics/datasource/cassandra/CassandraUtils.java","contents_url":"https://api.github.com/repos/wso2/carbon-analytics/contents/components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/main/java/org/wso2/carbon/analytics/datasource/cassandra/CassandraUtils.java?ref=2a3f35c271fab20991c987650fbfde3ed60c59ea","patch":"@@ -44,9 +44,14 @@\n     public static String generateCreateKeyspaceQuery(String ks, \n             Map<String, String> properties) throws AnalyticsException {\n         String className = extractClass(properties);\n-        int replicationFactor = extractReplicationFactor(properties);\n-        return \"CREATE KEYSPACE IF NOT EXISTS \" + ks + \" WITH REPLICATION = {'class':'\" + className + \n-                \"', 'replication_factor':\" + replicationFactor + \"}\";\n+        String query = \"CREATE KEYSPACE IF NOT EXISTS \" + ks + \" WITH REPLICATION = {'class':'\" + className + \"'\";\n+        if (className.equals(\"SimpleStrategy\")) {\n+            int replicationFactor = extractReplicationFactor(properties);\n+            query += \", 'replication_factor':\" + replicationFactor + \"}\";\n+        } else {\n+            query += \"}\";\n+        }\n+        return query;\n     }\n     \n     public static String extractDataSourceName(Map<String, String> properties) throws AnalyticsException {"},{"sha":"1021c2da26b23a8b602f950c27e86dc8941e783b","filename":"components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/test/java/org/wso2/carbon/analytics/datasource/cassandra/CassandraUtilsTest.java","status":"added","additions":46,"deletions":0,"changes":46,"blob_url":"https://github.com/wso2/carbon-analytics/blob/2a3f35c271fab20991c987650fbfde3ed60c59ea/components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/test/java/org/wso2/carbon/analytics/datasource/cassandra/CassandraUtilsTest.java","raw_url":"https://github.com/wso2/carbon-analytics/raw/2a3f35c271fab20991c987650fbfde3ed60c59ea/components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/test/java/org/wso2/carbon/analytics/datasource/cassandra/CassandraUtilsTest.java","contents_url":"https://api.github.com/repos/wso2/carbon-analytics/contents/components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/test/java/org/wso2/carbon/analytics/datasource/cassandra/CassandraUtilsTest.java?ref=2a3f35c271fab20991c987650fbfde3ed60c59ea","patch":"@@ -0,0 +1,46 @@\n+/*\n+ *  Copyright (c) 2016 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ *\n+ */\n+package org.wso2.carbon.analytics.datasource.cassandra;\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.analytics.datasource.commons.exception.AnalyticsException;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class CassandraUtilsTest {\n+\n+    @Test\n+    public void generateCreateKeyspaceQuerySimpleStrategyTest() throws AnalyticsException {\n+        Map<String, String> properties = new HashMap<>();\n+        properties.put(\"temp\", \"dummy\");\n+        String query = CassandraUtils.generateCreateKeyspaceQuery(\"ARS\", properties);\n+        String expectedResult = \"CREATE KEYSPACE IF NOT EXISTS ARS WITH REPLICATION = {'class':'SimpleStrategy', 'replication_factor':3}\";\n+        Assert.assertEquals(query, expectedResult);\n+    }\n+\n+    @Test\n+    public void generateCreateKeyspaceQueryNetworkStrategyTest() throws AnalyticsException {\n+        Map<String, String> properties = new HashMap<>();\n+        properties.put(\"class\", \"NetworkTopologyStrategy\");\n+        String query = CassandraUtils.generateCreateKeyspaceQuery(\"ARS\", properties);\n+        String expectedResult = \"CREATE KEYSPACE IF NOT EXISTS ARS WITH REPLICATION = {'class':'NetworkTopologyStrategy'}\";\n+        Assert.assertEquals(query, expectedResult);\n+    }\n+}"},{"sha":"33b8ecad828794cccb4aee06ecfa5c4e666de371","filename":"components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/test/resources/testng.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/wso2/carbon-analytics/blob/2a3f35c271fab20991c987650fbfde3ed60c59ea/components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/test/resources/testng.xml","raw_url":"https://github.com/wso2/carbon-analytics/raw/2a3f35c271fab20991c987650fbfde3ed60c59ea/components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/test/resources/testng.xml","contents_url":"https://api.github.com/repos/wso2/carbon-analytics/contents/components/analytics-data-connectors/org.wso2.carbon.analytics.datasource.cassandra/src/test/resources/testng.xml?ref=2a3f35c271fab20991c987650fbfde3ed60c59ea","patch":"@@ -4,6 +4,7 @@\n      <classes>\n         <class name=\"org.wso2.carbon.analytics.datasource.cassandra.CassandraAnalyticsRecordStoreTest\"/>\n         <class name=\"org.wso2.carbon.analytics.datasource.cassandra.CassandraAnalyticsDataServiceTest\"/>        \n+        <class name=\"org.wso2.carbon.analytics.datasource.cassandra.CassandraUtilsTest\"/>\n      </classes>\n    </test>\n </suite>"}]}