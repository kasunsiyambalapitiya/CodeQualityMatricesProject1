{"sha":"2b1d973d089ebc3af3b9e7b893f48cf905758cf4","commit":{"author":{"name":"Malintha Amarasinghe","email":"malintha.prasan@gmail.com","date":"2016-08-16T11:08:48Z"},"committer":{"name":"Malintha Amarasinghe","email":"malintha.prasan@gmail.com","date":"2016-08-16T11:08:54Z"},"message":"sending ACS and signed SAML requests in Publisher","tree":{"sha":"6bc4717c4b291fbbbb1726857d8c6eee7090104c","url":"https://api.github.com/repos/wso2/carbon-apimgt/git/trees/6bc4717c4b291fbbbb1726857d8c6eee7090104c"},"url":"https://api.github.com/repos/wso2/carbon-apimgt/git/commits/2b1d973d089ebc3af3b9e7b893f48cf905758cf4","comment_count":0},"url":"https://api.github.com/repos/wso2/carbon-apimgt/commits/2b1d973d089ebc3af3b9e7b893f48cf905758cf4","html_url":"https://github.com/wso2/carbon-apimgt/commit/2b1d973d089ebc3af3b9e7b893f48cf905758cf4","comments_url":"https://api.github.com/repos/wso2/carbon-apimgt/commits/2b1d973d089ebc3af3b9e7b893f48cf905758cf4/comments","author":{"login":"malinthaprasan","id":1591316,"avatar_url":"https://avatars.githubusercontent.com/u/1591316?v=3","gravatar_id":"","url":"https://api.github.com/users/malinthaprasan","html_url":"https://github.com/malinthaprasan","followers_url":"https://api.github.com/users/malinthaprasan/followers","following_url":"https://api.github.com/users/malinthaprasan/following{/other_user}","gists_url":"https://api.github.com/users/malinthaprasan/gists{/gist_id}","starred_url":"https://api.github.com/users/malinthaprasan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/malinthaprasan/subscriptions","organizations_url":"https://api.github.com/users/malinthaprasan/orgs","repos_url":"https://api.github.com/users/malinthaprasan/repos","events_url":"https://api.github.com/users/malinthaprasan/events{/privacy}","received_events_url":"https://api.github.com/users/malinthaprasan/received_events","type":"User","site_admin":false},"committer":{"login":"malinthaprasan","id":1591316,"avatar_url":"https://avatars.githubusercontent.com/u/1591316?v=3","gravatar_id":"","url":"https://api.github.com/users/malinthaprasan","html_url":"https://github.com/malinthaprasan","followers_url":"https://api.github.com/users/malinthaprasan/followers","following_url":"https://api.github.com/users/malinthaprasan/following{/other_user}","gists_url":"https://api.github.com/users/malinthaprasan/gists{/gist_id}","starred_url":"https://api.github.com/users/malinthaprasan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/malinthaprasan/subscriptions","organizations_url":"https://api.github.com/users/malinthaprasan/orgs","repos_url":"https://api.github.com/users/malinthaprasan/repos","events_url":"https://api.github.com/users/malinthaprasan/events{/privacy}","received_events_url":"https://api.github.com/users/malinthaprasan/received_events","type":"User","site_admin":false},"parents":[{"sha":"eaa45529cbabc5f30a2ffaa4781821ad0a5223ab","url":"https://api.github.com/repos/wso2/carbon-apimgt/commits/eaa45529cbabc5f30a2ffaa4781821ad0a5223ab","html_url":"https://github.com/wso2/carbon-apimgt/commit/eaa45529cbabc5f30a2ffaa4781821ad0a5223ab"}],"stats":{"total":63,"additions":40,"deletions":23},"files":[{"sha":"c471b93d025ee4775166436a09ed1b759edb2fec","filename":"features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/site/conf/site.json","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/wso2/carbon-apimgt/blob/2b1d973d089ebc3af3b9e7b893f48cf905758cf4/features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/site/conf/site.json","raw_url":"https://github.com/wso2/carbon-apimgt/raw/2b1d973d089ebc3af3b9e7b893f48cf905758cf4/features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/site/conf/site.json","contents_url":"https://api.github.com/repos/wso2/carbon-apimgt/contents/features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/site/conf/site.json?ref=2b1d973d089ebc3af3b9e7b893f48cf905758cf4","patch":"@@ -15,6 +15,8 @@\n         \"responseSigningEnabled\":\"true\",\n         \"assertionSigningEnabled\":\"true\",\n         \"keyStoreName\" :\"\",\n+        \"signRequests\" : \"true\",\n+        //\"acsURL\" : \"https://localhost:9443/publisher/jagg/jaggery_acs.jag\", //use only if Assertion Consumer Service URL needs to be sent along with SAML request \n         //\"nameIdPolicy\" : \"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\", //If not specified, 'urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified' will be used\n     },\n "},{"sha":"c716b3a1b6eeea271def4c97f3e7fd4d9547ebf0","filename":"features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/site/themes/wso2/templates/sso/filter/template.jag","status":"modified","additions":38,"deletions":23,"changes":61,"blob_url":"https://github.com/wso2/carbon-apimgt/blob/2b1d973d089ebc3af3b9e7b893f48cf905758cf4/features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/site/themes/wso2/templates/sso/filter/template.jag","raw_url":"https://github.com/wso2/carbon-apimgt/raw/2b1d973d089ebc3af3b9e7b893f48cf905758cf4/features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/site/themes/wso2/templates/sso/filter/template.jag","contents_url":"https://api.github.com/repos/wso2/carbon-apimgt/contents/features/apimgt/org.wso2.carbon.apimgt.publisher.feature/src/main/resources/publisher/site/themes/wso2/templates/sso/filter/template.jag?ref=2b1d973d089ebc3af3b9e7b893f48cf905758cf4","patch":"@@ -19,29 +19,44 @@\n \t}\n \tif (checkSSO && !Boolean(isAuthenticated)) {\n \n-\t    var keyStorePassword = site.ssoConfiguration.keyStorePassword;\n-            var keyStoreAlias = site.ssoConfiguration.identityAlias;\n-            var keyStoreLocation = site.ssoConfiguration.keyStoreName;\n-            var CarbonUtils = Packages.org.wso2.carbon.utils.CarbonUtils;\n-            if(site.ssoConfiguration.keyStorePassword == null || site.ssoConfiguration.keyStorePassword == \"\"){\n-                site.ssoConfiguration.keyStorePassword = CarbonUtils.getServerConfiguration().getFirstProperty(\"Security.KeyStore.Password\");\n-                }\n-            if(site.ssoConfiguration.identityAlias == null || site.ssoConfiguration.identityAlias == \"\"){\n-                site.ssoConfiguration.identityAlias = CarbonUtils.getServerConfiguration().getFirstProperty(\"Security.KeyStore.KeyAlias\");\n-                }\n-            if(site.ssoConfiguration.keyStoreName == null || site.ssoConfiguration.keyStoreName == \"\"){\n-                site.ssoConfiguration.keyStoreName = CarbonUtils.getServerConfiguration().getFirstProperty(\"Security.KeyStore.Location\");\n-                }\n-            if(site.ssoConfiguration.nameIdPolicy == null){\n-                site.ssoConfiguration.nameIdPolicy = \"\";\n-            }\n-            ssoRelyingParty.setProperty(\"identityProviderURL\", site.ssoConfiguration.identityProviderURL);\n-            ssoRelyingParty.setProperty(\"keyStorePassword\", String(site.ssoConfiguration.keyStorePassword));\n-            ssoRelyingParty.setProperty(\"identityAlias\", String(site.ssoConfiguration.identityAlias));\n-            ssoRelyingParty.setProperty(\"keyStoreName\", String(site.ssoConfiguration.keyStoreName));\n-            ssoRelyingParty.setProperty(\"nameIdPolicy\", site.ssoConfiguration.nameIdPolicy);\n-\n-\t    var samlAuthRequest = ssoRelyingParty.getSAMLAuthRequest();\n+        var keyStorePassword = site.ssoConfiguration.keyStorePassword;\n+        var acsURL = site.ssoConfiguration.acsURL;\n+        var signRequests = site.ssoConfiguration.signRequests;\n+        var keyStoreAlias = site.ssoConfiguration.identityAlias;\n+        var keyStoreLocation = site.ssoConfiguration.keyStoreName;\n+        var CarbonUtils = Packages.org.wso2.carbon.utils.CarbonUtils;\n+        if(site.ssoConfiguration.keyStorePassword == null || site.ssoConfiguration.keyStorePassword == \"\"){\n+            site.ssoConfiguration.keyStorePassword = CarbonUtils.getServerConfiguration().getFirstProperty(\"Security.KeyStore.Password\");\n+        }\n+        if(site.ssoConfiguration.identityAlias == null || site.ssoConfiguration.identityAlias == \"\"){\n+            site.ssoConfiguration.identityAlias = CarbonUtils.getServerConfiguration().getFirstProperty(\"Security.KeyStore.KeyAlias\");\n+        }\n+        if(site.ssoConfiguration.keyStoreName == null || site.ssoConfiguration.keyStoreName == \"\"){\n+            site.ssoConfiguration.keyStoreName = CarbonUtils.getServerConfiguration().getFirstProperty(\"Security.KeyStore.Location\");\n+        }\n+        if(site.ssoConfiguration.signRequests == null || site.ssoConfiguration.signRequests == \"\"){\n+            site.ssoConfiguration.signRequests = \"false\";\n+        }\n+        if(site.ssoConfiguration.nameIdPolicy == null){\n+            site.ssoConfiguration.nameIdPolicy = \"\";\n+        }\n+        ssoRelyingParty.setProperty(\"identityProviderURL\", site.ssoConfiguration.identityProviderURL);\n+        ssoRelyingParty.setProperty(\"keyStorePassword\", String(site.ssoConfiguration.keyStorePassword));\n+        ssoRelyingParty.setProperty(\"identityAlias\", String(site.ssoConfiguration.identityAlias));\n+        ssoRelyingParty.setProperty(\"keyStoreName\", String(site.ssoConfiguration.keyStoreName));\n+        ssoRelyingParty.setProperty(\"nameIdPolicy\", site.ssoConfiguration.nameIdPolicy);\n+        ssoRelyingParty.setProperty(\"signRequests\", String(site.ssoConfiguration.signRequests));\n+        ssoRelyingParty.setProperty(\"nameIdPolicy\", String(site.ssoConfiguration.nameIdPolicy));\n+\n+        var consumerUrl = \"\";\n+        //if acsURL is provided in site.json, consumerUrl will be taken from that. Otherwise not sent with the request.\n+        if (acsURL) {\n+            consumerUrl = String(acsURL);\n+            samlAuthRequest = ssoRelyingParty.getSAMLAuthRequest(consumerUrl);\n+        } else {\n+            samlAuthRequest = ssoRelyingParty.getSAMLAuthRequest();\n+        }\n+\n \t    var encodedRequest = ssoRelyingParty.encode(samlAuthRequest);\n \t    var relayState = ssoRelyingParty.getUUID();\n \t    ssoRelyingParty.setRelayStateProperty(relayState, requestURI);"}]}